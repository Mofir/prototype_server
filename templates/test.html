<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
	<title></title>
<script type="text/javascript">
const updateData = async(url, element) => {
			const sensorData = await fetch(url)
									  .then(response => response.text())
			const target = document.getElementById(element)
			target.innerHTML = `<h1>${sensorData}</h1>`
		}

window.onload = function() {

var dataPoints = [];

var chart = new CanvasJS.Chart("chartContainer", {
	theme: "light2",
	title: {
             text: "Live SpO2 Data"
            },
    axisX: {
    	title: "Time",
        valueFormatString: "hh:mm:ss"
            },

    axisY: {
        title: "%SpO2",
            },
    data: [{
        type: "spline",
        xValueType: "dateTime",
        dataPoints: dps
                }]
            });
updateData();

var yVal = [{${sensorData}}];
            var updateInterval = 1000;
            var maxDataLength = yVal.length; // number of dataPoints after which the series shifts
            var time = new Date();
            var updateCount = 0;

            var updateChart = function (count) {

                count = count || 1;

                for (var j = 0; j < count; j++) {
                    time.setSeconds(time.getSeconds() + 1);

                    dps.push({
                        x: time.getTime(),
                        y: yVal[updateCount % yVal.length]
                    });

                    updateCount++;

                    if (dps.length > maxDataLength) {
                        dps.shift();
                    }
                }
                

                chart.render();

            };

            // generates first set of dataPoints
            updateChart(maxDataLength);

            // update chart after specified time.
            setInterval(function () { updateChart();}, updateInterval);
}
</script>
</head>
<body>
<div id="chartContainer" style="height: 360px; width: 100%;"></div>
<p class="description">Temperature graph. Updates every second.<br/> 
</p>
</body>
</html>